{"ast":null,"code":"import _regeneratorRuntime from\"/Users/donghoon/works/movie/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/donghoon/works/movie/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/donghoon/works/movie/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/donghoon/works/movie/node_modules/@babel/runtime/helpers/esm/createClass\";import*as firebase from'firebase/app';import'firebase/database';var Api=/*#__PURE__*/function(){function Api(){_classCallCheck(this,Api);this.basePath='/data/movies';this.database=firebase.database().ref(this.basePath).once('value').then(function(d){return d.val();});}_createClass(Api,[{key:\"getMovies\",value:function getMovies(){return this.database;}},{key:\"getMovie\",value:function(){var _getMovie=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var movies;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.database;case 2:movies=_context.sent;return _context.abrupt(\"return\",movies.filter(function(_ref){var dataId=_ref.id;return id===dataId;}).slice(-1).pop());case 4:case\"end\":return _context.stop();}}},_callee,this);}));function getMovie(_x){return _getMovie.apply(this,arguments);}return getMovie;}()},{key:\"makeHeaders\",value:function makeHeaders(){var auth=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var headers={'Content-Type':'application/x-www-form-urlencoded'};if(auth)headers.Authorization=\"Key \".concat(localStorage.getItem('key'));return headers;}},{key:\"signup\",value:function signup(name){return fetch(\"\".concat(this.BASE_URL,\"/signup\"),{method:'POST',headers:this.makeHeaders(),body:\"name=\".concat(name)}).then(function(res){return res.json();}).then(function(_ref2){var key=_ref2.key;return localStorage.setItem('key',key);});}},{key:\"login\",value:function login(){return fetch(\"\".concat(this.BASE_URL,\"/login\"),{method:'POST',headers:this.makeHeaders(true)}).then(function(res){return res.json();});}},{key:\"joinRoom\",value:function joinRoom(id){return fetch(\"\".concat(this.BASE_URL,\"/rooms/\").concat(id),{method:'POST',headers:this.makeHeaders(true)}).then(function(res){return res.json();});}},{key:\"getRooms\",value:function getRooms(){return fetch(\"\".concat(this.BASE_URL,\"/rooms\")).then(function(res){return res.json();});}},{key:\"createRoom\",value:function createRoom(name){return fetch(\"\".concat(this.BASE_URL,\"/rooms\"),{method:'POST',headers:this.makeHeaders(true),body:\"name=\".concat(name)}).then(function(res){return res.json();});}},{key:\"getRoom\",value:function getRoom(roomId){return fetch(\"\".concat(this.BASE_URL,\"/rooms/\").concat(roomId)).then(function(res){return res.json();});}},{key:\"getChats\",value:function getChats(roomId){return fetch(\"\".concat(this.BASE_URL,\"/rooms/\").concat(roomId,\"/chats\")).then(function(res){return res.json();});}},{key:\"sendMessage\",value:function sendMessage(roomId,message){return fetch(\"\".concat(this.BASE_URL,\"/rooms/\").concat(roomId,\"/chats\"),{method:'POST',headers:this.makeHeaders(true),body:\"message=\".concat(message)}).then(function(res){return res.json();});}}]);return Api;}();export{Api as default};","map":{"version":3,"sources":["/Users/donghoon/works/movie/src/api/api.js"],"names":["firebase","Api","basePath","database","ref","once","then","d","val","id","movies","filter","dataId","slice","pop","auth","headers","Authorization","localStorage","getItem","name","fetch","BASE_URL","method","makeHeaders","body","res","json","key","setItem","roomId","message"],"mappings":"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","sourcesContent":["import * as firebase from 'firebase/app';\nimport 'firebase/database';\n\nexport default class Api {\n  constructor() {\n    this.basePath = '/data/movies';\n    this.database = firebase.database().ref(this.basePath).once('value').then((d) => d.val());\n  }\n\n  getMovies() {\n    return this.database;\n  }\n\n  async getMovie(id) {\n    const movies = await this.database;\n    return movies.filter(({ id: dataId }) => id === dataId).slice(-1).pop();\n  }\n\n  makeHeaders(auth = false) {\n    const headers = {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    };\n    if (auth) headers.Authorization = `Key ${localStorage.getItem('key')}`;\n    return headers;\n  }\n\n  signup(name) {\n    return fetch(`${this.BASE_URL}/signup`, {\n      method: 'POST',\n      headers: this.makeHeaders(),\n      body: `name=${name}`,\n    })\n      .then((res) => res.json())\n      .then(({ key }) => localStorage.setItem('key', key));\n  }\n\n  login() {\n    return fetch(`${this.BASE_URL}/login`, {\n      method: 'POST',\n      headers: this.makeHeaders(true),\n    }).then((res) => res.json());\n  }\n\n  joinRoom(id) {\n    return fetch(`${this.BASE_URL}/rooms/${id}`, {\n      method: 'POST',\n      headers: this.makeHeaders(true),\n    }).then((res) => res.json());\n  }\n\n  getRooms() {\n    return fetch(`${this.BASE_URL}/rooms`).then((res) => res.json());\n  }\n\n  createRoom(name) {\n    return fetch(`${this.BASE_URL}/rooms`, {\n      method: 'POST',\n      headers: this.makeHeaders(true),\n      body: `name=${name}`,\n    }).then((res) => res.json());\n  }\n\n  getRoom(roomId) {\n    return fetch(`${this.BASE_URL}/rooms/${roomId}`).then((res) => res.json());\n  }\n\n  getChats(roomId) {\n    return fetch(`${this.BASE_URL}/rooms/${roomId}/chats`).then((res) => res.json());\n  }\n\n  sendMessage(roomId, message) {\n    return fetch(`${this.BASE_URL}/rooms/${roomId}/chats`, {\n      method: 'POST',\n      headers: this.makeHeaders(true),\n      body: `message=${message}`,\n    }).then((res) => res.json());\n  }\n}\n"]},"metadata":{},"sourceType":"module"}